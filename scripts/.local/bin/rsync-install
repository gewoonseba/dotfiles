#!/usr/bin/env bash
set -e

# rsync-install - Install rsync (file synchronization tool)

echo "󰄬 Installing rsync..."

# Detect OS
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    # Linux
    if ! command -v yay &> /dev/null; then
        echo "󰅙 Error: yay is required but not installed."
        exit 1
    fi

    if command -v rsync &> /dev/null; then
        CURRENT_VERSION=$(rsync --version | head -n1)
        echo "  rsync is already installed: $CURRENT_VERSION"
        read -p "  Reinstall/upgrade? [y/N] " -n 1 -r
        echo
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            echo "  Skipping installation."
            exit 0
        fi
    fi

    echo "  Installing rsync via yay..."
    yay -S --noconfirm rsync

elif [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    if ! command -v brew &> /dev/null; then
        echo "󰅙 Error: Homebrew is required but not installed."
        exit 1
    fi

    if command -v rsync &> /dev/null; then
        CURRENT_VERSION=$(rsync --version | head -n1)
        echo "  rsync is already installed: $CURRENT_VERSION"
        echo "  Note: macOS comes with rsync, but you can upgrade via Homebrew"
        read -p "  Install/upgrade via Homebrew? [y/N] " -n 1 -r
        echo
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            echo "  Skipping installation."
            exit 0
        fi
    fi

    echo "  Installing rsync via Homebrew..."
    brew install rsync

else
    echo "󰅙 Error: Unsupported operating system: $OSTYPE"
    exit 1
fi

echo "󰄬 rsync installed successfully"
